@using PagedList.Mvc
@using PagedList
@model IPagedList<DemoWeb.Models.Product>

@{
    ViewBag.Title = "Sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Breadcrumb {
    <div class="breadcrumb-box">
        <a href="@Url.Action("Index","Trangchu")">Trang chủ</a>
        <span class="breadcrumb-sep">/</span>
        <span>Sản phẩm</span>
    </div>
}


<div class="container">
    <!-- HERO SECTION -->
    <!-- BỘ LỌC NGANG -->
    <div style="background:#fff; border:1px solid #e9ecef; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); padding:2rem; margin-bottom:0;">
        <div style="margin-bottom:0;">
            <h3 style="font-size:0.85rem; font-weight:700; letter-spacing:0.1em; color:#d4af37; text-transform:uppercase; margin:0; padding-bottom:0.75rem; border-bottom:2px solid #d4af37; display:inline-block;">
                Bộ lọc sản phẩm
            </h3>
            <h3 style="font-size:0.85rem; font-weight:700; letter-spacing:0.1em; color:#d4af37; text-transform:uppercase; margin:0; padding-bottom:0.75rem; border-bottom:2px solid #d4af37; display:inline-block;">
                <a href="@Url.Action("Index","MeasureRingSize")"
                   style="font-size: 0.85rem; font-weight: 700; color: #d4af37; text-decoration: none; ">
                    📏 Đo ni tay
                </a>
            </h3>
        </div>

        <form method="get" action="@Url.Action("Index","Product")">

            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:1.25rem; margin-bottom:1.5rem;">

                <!-- Loại vàng -->
                <div>
                    <label style="display:block; font-size:0.875rem; font-weight:600; color:#333; margin-bottom:0.5rem;">
                        Loại vàng
                    </label>
                    <select name="loai" style="width:100%; padding:0.75rem 1rem; border:1px solid #e9ecef; border-radius:8px; font-size:0.95rem; color:#333; background-color:#fafafa; cursor:pointer;">
                        <option value="">Tất cả</option>
                        <option value="Vàng 24K" @(ViewBag.CurrentLoai == "Vàng 24K" ? "selected" : "")>Vàng 24K</option>
                        <option value="Vàng 18K" @(ViewBag.CurrentLoai == "Vàng 18K" ? "selected" : "")>Vàng 18K</option>
                        <option value="Vàng 14K" @(ViewBag.CurrentLoai == "Vàng 14K" ? "selected" : "")>Vàng 14K</option>
                        <option value="Vàng 10K" @(ViewBag.CurrentLoai == "Vàng 10K" ? "selected" : "")>Vàng 10K</option>
                        <option value="Vàng Ý 24K" @(ViewBag.CurrentLoai == "Vàng Ý 24K" ? "selected" : "")>Vàng Ý 24K</option>
                        <option value="Vàng Ý 18K" @(ViewBag.CurrentLoai == "Vàng Ý 18K" ? "selected" : "")>Vàng Ý 18K</option>
                        <option value="Vàng Ý 14K" @(ViewBag.CurrentLoai == "Vàng Ý 14K" ? "selected" : "")>Vàng Ý 14K</option>
                        <option value="Vàng Ý 10K" @(ViewBag.CurrentLoai == "Vàng Ý 10K" ? "selected" : "")>Vàng Ý 10K</option>
                        <option value="Vàng Trắng 24K" @(ViewBag.CurrentLoai == "Vàng Trắng 24K" ? "selected" : "")>Vàng Trắng 24K</option>
                        <option value="Vàng Trắng 18K" @(ViewBag.CurrentLoai == "Vàng Trắng 18K" ? "selected" : "")>Vàng Trắng 18K</option>
                        <option value="Vàng Trắng 14K" @(ViewBag.CurrentLoai == "Vàng Trắng 14K" ? "selected" : "")>Vàng Trắng 14K</option>
                        <option value="Vàng Trắng 10K" @(ViewBag.CurrentLoai == "Vàng Trắng 10K" ? "selected" : "")>Vàng Trắng 10K</option>
                        <option value="Vàng Trắng Ý 24K" @(ViewBag.CurrentLoai == "Vàng Trắng Ý 24K" ? "selected" : "")>Vàng Trắng Ý 24K</option>
                        <option value="Vàng Trắng Ý 18K" @(ViewBag.CurrentLoai == "Vàng Trắng Ý 18K" ? "selected" : "")>Vàng Trắng Ý 18K</option>
                        <option value="Vàng Trắng Ý 14K" @(ViewBag.CurrentLoai == "Vàng Trắng Ý 14K" ? "selected" : "")>Vàng Trắng Ý 14K</option>
                        <option value="Vàng Trắng Ý 10K" @(ViewBag.CurrentLoai == "Vàng Trắng Ý 10K" ? "selected" : "")>Vàng Trắng Ý 10K</option>
                        <option value="Bạc" @(ViewBag.CurrentLoai == "Bạc" ? "selected" : "")>Bạc</option>
                        <option value="Bạc Ý" @(ViewBag.CurrentLoai == "Bạc Ý" ? "selected" : "")>Bạc Ý</option>


                    </select>
                </div>

                <!-- Giới tính -->
                <div>
                    <label style="display:block; font-size:0.875rem; font-weight:600; color:#333; margin-bottom:0.5rem;">
                        Dành cho
                    </label>
                    <select name="gender" style="width:100%; padding:0.75rem 1rem; border:1px solid #e9ecef; border-radius:8px; font-size:0.95rem; color:#333; background-color:#fafafa; cursor:pointer;">
                        <option value="">Tất cả</option>
                        <option value="Nam" @(ViewBag.CurrentGender == "Nam" ? "selected" : "")>Nam</option>
                        <option value="Nữ" @(ViewBag.CurrentGender == "Nữ" ? "selected" : "")>Nữ</option>
                        <option value="Unisex" @(ViewBag.CurrentGender == "Unisex" ? "selected" : "")>Unisex</option>
                    </select>
                </div>

                <!-- Loại sản phẩm -->
                <div>
                    <label style="display:block; font-size:0.875rem; font-weight:600; color:#333; margin-bottom:0.5rem;">
                        Loại sản phẩm
                    </label>
                    <select name="category" style="width:100%; padding:0.75rem 1rem; border:1px solid #e9ecef; border-radius:8px; font-size:0.95rem; color:#333; background-color:#fafafa; cursor:pointer;">
                        <option value="">Tất cả</option>
                        <option value="Nhẫn" @(ViewBag.CurrentCategory == "Nhẫn" ? "selected" : "")>Nhẫn</option>
                        <option value="Dây Chuyền" @(ViewBag.CurrentCategory == "Dây Chuyền" ? "selected" : "")>Dây chuyền</option>
                        <option value="Lắc" @(ViewBag.CurrentCategory == "Lắc" ? "selected" : "")>Lắc </option>
                        <option value="Bông Tai" @(ViewBag.CurrentCategory == "Bông Tai" ? "selected" : "")>Bông tai</option>
                        <option value="Vòng" @(ViewBag.CurrentCategory == "Vòng" ? "selected" : "")>Vòng</option>
                        <option value="Kiềng" @(ViewBag.CurrentCategory == "Kiềng" ? "selected" : "")>Kiềng</option>
                    </select>
                </div>

                <!-- Khoảng giá -->
                <div>
                    <label style="display:block; font-size:0.875rem; font-weight:600; color:#333; margin-bottom:0.5rem;">
                        Khoảng giá
                    </label>
                    <select name="price" style="width:100%; padding:0.75rem 1rem; border:1px solid #e9ecef; border-radius:8px; font-size:0.95rem; color:#333; background-color:#fafafa; cursor:pointer;">
                        <option value="">Tất cả</option>
                        <option value="0-5" @(ViewBag.CurrentPrice == "0-5" ? "selected" : "")>Dưới 5 triệu</option>
                        <option value="5-10" @(ViewBag.CurrentPrice == "5-10" ? "selected" : "")>5 - 10 triệu</option>
                        <option value="10-20" @(ViewBag.CurrentPrice == "10-20" ? "selected" : "")>10 - 20 triệu</option>
                        <option value="20-50" @(ViewBag.CurrentPrice == "20-50" ? "selected" : "")>20 - 50 triệu</option>
                        <option value="50-100" @(ViewBag.CurrentPrice == "50-100" ? "selected" : "")>50 - 100 triệu</option>
                        <option value="100" @(ViewBag.CurrentPrice == "100" ? "selected" : "")>Trên 100 triệu</option>
                    </select>
                </div>

                <!-- Tìm kiếm -->
                <div style="grid-column: span 2;">
                    <label style="display:block; font-size:0.875rem; font-weight:600; color:#333; margin-bottom:0.5rem;">
                        Tìm tên sản phẩm
                    </label>
                    <input name="q" type="text" value="@ViewBag.CurrentQ"
                           placeholder="Nhập từ khóa..."
                           style="width:100%; padding:0.75rem 1rem; border:1px solid #e9ecef; border-radius:8px; font-size:0.95rem; color:#333; background-color:#fafafa;" />
                </div>
            </div>

            <!-- Buttons -->
            <div style="display:flex; gap:1rem; justify-content:flex-end;">
                <button type="submit" style="background-color:#d4af37; color:#000; border:none; border-radius:8px; padding:0.875rem 2rem; font-size:0.875rem; font-weight:700; text-transform:uppercase; letter-spacing:0.05em; cursor:pointer; transition:all 0.3s ease;">
                    ÁP DỤNG LỌC
                </button>

                @if (!string.IsNullOrEmpty(ViewBag.CurrentLoai) ||
                     !string.IsNullOrEmpty(ViewBag.CurrentGender) ||
                     !string.IsNullOrEmpty(ViewBag.CurrentCategory) ||
                     !string.IsNullOrEmpty(ViewBag.CurrentPrice) ||
                     !string.IsNullOrEmpty(ViewBag.CurrentQ))
                {
                    <a href="@Url.Action("Index")" style="background-color:transparent; color:#666; border:1px solid #e9ecef; border-radius:8px; padding:0.875rem 1.5rem; font-size:0.875rem; font-weight:600; text-decoration:none; display:inline-flex; align-items:center; transition:all 0.3s ease;">
                        XÓA BỘ LỌC
                    </a>
                }
            </div>
        </form>
    </div>

    <!-- SECTION HEADER -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; padding-bottom:1rem; border-bottom:1px solid #e9ecef;">
        <h2 style="font-size:0.95rem; font-weight:700; color:#d4af37; letter-spacing:0.08em; text-transform:uppercase; margin:0;">
            TẤT CẢ SẢN PHẨM
        </h2>
        <span style="font-size:0.9rem; color:#666;">
            Hiển thị @Model.FirstItemOnPage - @Model.LastItemOnPage trong tổng số @Model.TotalItemCount sản phẩm
        </span>
    </div>

    <!-- DANH SÁCH SẢN PHẨM -->
    <div class="row">
        @if (Model != null && Model.Any())
        {
            foreach (var item in Model)
            {
                <div class="col-sm-6 col-md-4 col-lg-3 mb-4" style="display:flex; flex-direction:column;">
                    <div class="product-card"
                         onclick="window.location='@Url.Action("Details","Product", new { id = item.Id })';"
                         style="display:flex; flex-direction:column; height:100%; min-height:450px; cursor:pointer;">

                        <!-- PHẦN ẢNH SẢN PHẨM -->
                        <div class="product-img" style="height:220px; min-height:220px; flex-shrink:0;">
                            @if (!string.IsNullOrEmpty(item.Image))
                            {
                                <img src="@Url.Content(item.Image)"
                                     alt="@item.Name"
                                     onerror="this.src='@Url.Content("~/Content/Images/no-image.jpg")'" />
                            }
                            

                        </div>

                        <!-- TÊN SẢN PHẨM -->
                        <div class="product-name" style="min-height:2.8rem; max-height:2.8rem; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; margin-bottom:8px;">
                            <h6>@item.Name</h6> 
                        </div>

                        <!-- MÔ TẢ -->
                        <div class="product-desc" style="min-height:2.6rem; max-height:2.6rem; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; margin-bottom:8px;">
                            <em>
                                @if (!string.IsNullOrEmpty(item.Description))
                                {
                                    @(item.Description.Length > 50 ? item.Description.Substring(0, 50) + "..." : item.Description)
                                }
                                else
                                {
                                    <text>Sản phẩm cao cấp, chất lượng</text>
                                }
                             </em>
                            
                        </div>

                        <!-- GIÁ -->
                        <div class="product-price" style="min-height:1.4rem; margin-bottom:12px;">
                            <h6>
                                @if (item.Price > 0)
                                {
                                    @item.Price.ToString("N0")<text>₫</text>
                                }
                                else
                                {
                                    <text>Liên hệ báo giá</text>
                                }
                             </h6>
                            
                        </div>


                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center" style="padding:60px 20px;">
                <i class="fas fa-search" style="font-size:4rem; color:#ccc; margin-bottom:20px;"></i>
                <p style="font-size:1.3rem; color:#666; margin-bottom:10px;">Không tìm thấy sản phẩm nào</p>
                <p style="font-size:1rem; color:#999;">Vui lòng thử tìm kiếm với từ khóa khác</p>
                <a href="@Url.Action("Index")" class="btn btn-primary" style="margin-top:20px;">Xem tất cả sản phẩm</a>
            </div>
        }
    </div>

    <!-- PHÂN TRANG -->
    @if (Model != null && Model.PageCount > 1)
    {
        <nav aria-label="Page navigation" style="margin: 40px 0;">
            <ul class="pagination justify-content-center">
                <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                    <a class="page-link"
                       href="@(Model.HasPreviousPage ? Url.Action("Index", new { page = 1, loai = ViewBag.CurrentLoai, gender = ViewBag.CurrentGender, category = ViewBag.CurrentCategory, price = ViewBag.CurrentPrice, q = ViewBag.CurrentQ }) : "javascript:void(0)")">
                        &laquo;&laquo;
                    </a>
                </li>

                <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                    <a class="page-link"
                       href="@(Model.HasPreviousPage ? Url.Action("Index", new { page = Model.PageNumber - 1, loai = ViewBag.CurrentLoai, gender = ViewBag.CurrentGender, category = ViewBag.CurrentCategory, price = ViewBag.CurrentPrice, q = ViewBag.CurrentQ }) : "javascript:void(0)")">
                        &laquo;
                    </a>
                </li>

                @{
                    int startPage = Math.Max(1, Model.PageNumber - 2);
                    int endPage = Math.Min(Model.PageCount, Model.PageNumber + 2);
                }

                @for (int i = startPage; i <= endPage; i++)
                {
                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                        <a class="page-link"
                           href="@Url.Action("Index", new { page = i, loai = ViewBag.CurrentLoai, gender = ViewBag.CurrentGender, category = ViewBag.CurrentCategory, price = ViewBag.CurrentPrice, q = ViewBag.CurrentQ })">
                            @i
                        </a>
                    </li>
                }

                <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                    <a class="page-link"
                       href="@(Model.HasNextPage ? Url.Action("Index", new { page = Model.PageNumber + 1, loai = ViewBag.CurrentLoai, gender = ViewBag.CurrentGender, category = ViewBag.CurrentCategory, price = ViewBag.CurrentPrice, q = ViewBag.CurrentQ }) : "javascript:void(0)")">
                        &raquo;
                    </a>
                </li>

                <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                    <a class="page-link"
                       href="@(Model.HasNextPage ? Url.Action("Index", new { page = Model.PageCount, loai = ViewBag.CurrentLoai, gender = ViewBag.CurrentGender, category = ViewBag.CurrentCategory, price = ViewBag.CurrentPrice, q = ViewBag.CurrentQ }) : "javascript:void(0)")">
                        &raquo;&raquo;
                    </a>
                </li>
            </ul>
        </nav>
    }
</div>

<!-- Thông báo thêm vào giỏ hàng -->
@if (TempData["Message"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert" style="position:fixed; top:80px; right:20px; z-index:9999; min-width:300px;">
        <strong>Thành công!</strong> @TempData["Message"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

<style>
    .row > [class*="col-"] {
        display: flex;
        flex-direction: column;
    }

    .product-card:hover {
        transform: translateY(-8px) !important;
        box-shadow: 0 24px 48px rgba(0,0,0,0.15) !important;
    }

        .product-card:hover .product-img img {
            transform: scale(1.1) !important;
        }

        .product-card:hover .product-name {
            color: var(--brand-gold) !important;
        }
    .product-name {
        display: -webkit-box; /* Tạo khung để cắt text theo dòng */
        -webkit-line-clamp: 2; /* Số dòng tối đa hiển thị */
        -webkit-box-orient: vertical;
        overflow: hidden; /* Ẩn phần text dư thừa */
        text-overflow: ellipsis; /* Hiển thị ... */
        min-height: 2.8rem; /* Chiều cao tối thiểu, tùy chỉnh */
        max-height: 2.8rem; /* Chiều cao tối đa, phù hợp 2 dòng */
    }

</style>
