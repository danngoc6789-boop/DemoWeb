@model DemoWeb.Models.Product

@{
    ViewBag.Title = Model.Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Breadcrumb {
    <div class="breadcrumb-box">
        <a href="@Url.Action("Index","Trangchu")">Trang chủ</a>
        <span class="breadcrumb-sep">/</span>
        <a href="@Url.Action("Index","Product")">Sản phẩm</a>
        <span class="breadcrumb-sep">/</span>
        <span>@Model.Name</span>
    </div>
}

<div class="row">
    <!-- Cột trái: Gallery ảnh -->
    <div class="col-md-5">
        <div class="product-gallery">
            <!-- Ảnh chính lớn -->
            <div style="position:relative; margin-bottom:12px;">
                <img id="mainImage"
                     src="@Url.Content(Model.MainImage)"
                     alt="@Model.Name"
                     style="width:100%; display:block; border-radius:8px;"
                     onerror="this.src='@Url.Content("~/Content/Images/no-image.jpg")'" />

                @if (Model.AllImages != null && Model.AllImages.Count > 1)
                {
                    <div style="position:absolute; top:12px; right:12px; background:rgba(0,0,0,0.7); color:#fff; padding:6px 14px; border-radius:20px; font-size:0.85rem;">
                        @Model.AllImages.Count ảnh
                    </div>
                }
            </div>

            <!-- Thumbnails -->
            @if (Model.AllImages != null && Model.AllImages.Count > 1)
            {
                <div style="display:flex; gap:10px; overflow-x:auto;">
                    @for (int i = 0; i < Model.AllImages.Count; i++)
                    {
                        var imgPath = Model.AllImages[i];
                        var isFirst = (i == 0);
                        <img src="@Url.Content(imgPath)"
                             alt="@Model.Name"
                             class="thumbnail-image"
                             onclick="changeMainImage('@Url.Content(imgPath)', this)"
                             style="width:80px; height:80px; object-fit:cover; cursor:pointer; border:2px solid @(isFirst ? "var(--brand-gold)" : "#ddd"); border-radius:5px; flex-shrink:0; transition: all 0.3s;"
                             onerror="this.style.display='none'" />
                    }
                </div>
            }
        </div>
    </div>

    <!-- Cột phải: Thông tin sản phẩm -->
    <div class="col-md-7">
        <!-- Category -->
        <div style="font-size:0.75rem; font-weight:600; text-transform:uppercase; letter-spacing:0.12em; color:var(--brand-gold); margin-bottom:12px;">
            @(Model.Category ?? "SẢN PHẨM")
        </div>

        <!-- Tên sản phẩm -->
        <h1 style="font-size:2.2rem; font-weight:700; line-height:1.2; color:#000; margin-bottom:16px;">
            @Model.Name
        </h1>

        <!-- Mã SP và Loại -->
        <div style="font-size:0.9rem; color:#666; margin-bottom:24px;">
            <span>Mã SP: DTJ@(Model.Id.ToString().PadLeft(6, '0'))</span>
            @if (!string.IsNullOrEmpty(Model.Type))
            {
                <span style="margin-left:16px;">• @Model.Type</span>
            }
        </div>

        <!-- Giá -->
        <div style="margin-bottom:8px;">
            <span style="font-size:2.8rem; font-weight:700; color:var(--brand-gold); line-height:1;">
                @if (Model.Price > 0)
                {
                    @Model.Price.ToString("N0")
                }
                else
                {
                    <text>Liên hệ</text>
                }
            </span>
            @if (Model.Price > 0)
            {
                <span style="font-size:1.4rem; font-weight:600; color:var(--brand-gold);">₫</span>
            }
        </div>

        <p style="font-size:0.85rem; color:#666; margin-bottom:32px;">
            (Giá đã bao gồm VAT)
        </p>

        <!-- FORM THÊM VÀO GIỎ -->
        @using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post, new { id = "addToCartForm" }))
        {
            @Html.AntiForgeryToken()
            @Html.Hidden("id", Model.Id)

            <!-- Chọn Size -->
            if (Model.Sizes != null && Model.Sizes.Any())
            {
            <div style="margin-bottom:28px;">
                <label style="display:block; font-weight:600; font-size:0.95rem; color:#000; margin-bottom:12px;">
                    Chọn kích thước: <span style="color:red;">*</span>
                </label>
                <div class="size-options" style="display:flex; flex-wrap:wrap; gap:6px;">
                    @foreach (var size in Model.Sizes)
                    {
                        var sizeId = "size_" + Guid.NewGuid().ToString("N").Substring(0, 8);
                        <label class="size-option-label" style="position:relative; cursor:pointer; margin:0;">
                            <input type="radio"
                                   id="@sizeId"
                                   name="size"
                                   value="@size"
                                   style="position:absolute; opacity:0; cursor:pointer;" />
                            <span class="size-display" style="display:inline-block; min-width:38px; padding:6px 10px; text-align:center; border:1.5px solid #ddd; border-radius:4px; font-weight:500; font-size:0.8rem; background:#fff; transition: all 0.3s;">
                                @size
                            </span>
                        </label>
                    }
                </div>
                <div class="product-sizes" data-require-size="true">
                    @foreach (var size in Model.Sizes)
                    {
                        <input type="radio" name="size" value="@size" />
                    }
                </div>
                <!-- Thông báo lỗi - chỉ hiện khi submit -->
                <small id="sizeError" style="display:none; margin-top:8px; color:#dc3545; font-size:0.85rem; font-weight:500;">
                    <i class="fas fa-exclamation-circle"></i> Vui lòng chọn kích thước trước khi thêm vào giỏ hàng
                </small>
            </div>
            }
            else
            {
                @Html.Hidden("size", "")
            }

            <!-- Số lượng -->
            <div style="margin-bottom:28px;">
                <label style="display:block; font-weight:600; font-size:0.95rem; color:#000; margin-bottom:12px;">
                    Số lượng:
                </label>
                <div style="display:flex; align-items:center; gap:12px; max-width:180px;">
                    <button type="button"
                            onclick="decreaseQty()"
                            style="width:40px; height:40px; border:1px solid #ddd; background:#fff; border-radius:5px; cursor:pointer; font-size:1.2rem; display:flex; align-items:center; justify-content:center; transition: all 0.3s;">
                        −
                    </button>
                    <input type="number"
                           name="quantity"
                           id="quantity"
                           value="1"
                           min="1"
                           max="99"
                           required
                           style="width:80px; height:40px; text-align:center; border:1px solid #ddd; border-radius:5px; font-weight:600; font-size:1rem;" />
                    <button type="button"
                            onclick="increaseQty()"
                            style="width:40px; height:40px; border:1px solid #ddd; background:#fff; border-radius:5px; cursor:pointer; font-size:1.2rem; display:flex; align-items:center; justify-content:center; transition: all 0.3s;">
                        +
                    </button>
                </div>
            </div>

            <!-- Button thêm vào giỏ -->
            <div style="margin-bottom:32px;">
                <button type="submit"
                        class="btn-round-black"
                        style="display:block; width:100%; padding:18px; font-size:1rem; font-weight:600; text-transform:uppercase; letter-spacing:0.05em; border:none; cursor:pointer; transition: all 0.3s;">
                    <i class="fas fa-shopping-cart"></i> THÊM VÀO GIỎ HÀNG
                </button>
            </div>
        }

        <!-- Mô tả sản phẩm -->
        @if (!string.IsNullOrEmpty(Model.Description))
        {
            <div style="padding:20px; background:#f8f8f8; border-left:4px solid var(--brand-gold); margin-bottom:28px; border-radius:5px;">
                <h3 style="font-size:1rem; font-weight:600; color:#000; margin-bottom:8px;">
                    Mô tả sản phẩm
                </h3>
                <p style="font-size:0.95rem; line-height:1.6; color:#555; margin:0;">
                    @Html.Raw(Model.Description)
                </p>
            </div>
        }

        <!-- Thông tin bổ sung -->
        <div style="border-top:1px solid #e5e5e5; padding-top:24px;">
            <div style="margin-bottom:16px; display:flex; align-items:start; gap:12px;">
                <i class="fas fa-shield-alt" style="color:var(--brand-gold); font-size:1.3rem; margin-top:2px;"></i>
                <div>
                    <div style="font-weight:600; font-size:0.95rem; color:#000; margin-bottom:4px;">
                        Bảo hành trọn đời
                    </div>
                    <div style="font-size:0.85rem; color:#666;">
                        Đổi trả trong 48h - Bảo hành làm sáng miễn phí
                    </div>
                </div>
            </div>

            <div style="margin-bottom:16px; display:flex; align-items:start; gap:12px;">
                <i class="fas fa-shipping-fast" style="color:var(--brand-gold); font-size:1.3rem; margin-top:2px;"></i>
                <div>
                    <div style="font-weight:600; font-size:0.95rem; color:#000; margin-bottom:4px;">
                        Miễn phí vận chuyển
                    </div>
                    <div style="font-size:0.85rem; color:#666;">
                        Cho đơn từ 5.000.000₫ - Giao hàng toàn quốc
                    </div>
                </div>
            </div>

            <div style="display:flex; align-items:start; gap:12px;">
                <i class="fas fa-gift" style="color:var(--brand-gold); font-size:1.3rem; margin-top:2px;"></i>
                <div>
                    <div style="font-weight:600; font-size:0.95rem; color:#000; margin-bottom:4px;">
                        Quà tặng hấp dẫn
                    </div>
                    <div style="font-size:0.85rem; color:#666;">
                        Hộp sang trọng & giấy chứng nhận vàng 24K
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Style cho size options */
    .size-option-label input[type="radio"]:checked + .size-display {
        background-color: var(--brand-gold);
        color: #fff;
        border-color: var(--brand-gold);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .size-option-label:hover .size-display {
        border-color: var(--brand-gold);
        transform: translateY(-2px);
    }

    /* Style cho quantity buttons */
    button[onclick*="Qty"]:hover {
        background-color: #f5f5f5 !important;
        border-color: var(--brand-gold) !important;
    }

    /* Style cho thumbnail hover */
    .thumbnail-image:hover {
        border-color: var(--brand-gold) !important;
        transform: scale(1.05);
    }

    /* Ẩn spinner của number input */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>

<script>
    document.getElementById('addToCartForm').addEventListener('submit', function (e) {
        // Chỉ lấy radio buttons, không lấy hidden input
        var sizeRadioInputs = document.querySelectorAll('input[name="size"][type="radio"]');
        if (sizeRadioInputs.length > 0) {
            var sizeSelected = Array.from(sizeRadioInputs).some(input => input.checked);
            if (!sizeSelected) {
                e.preventDefault();
                alert('Vui lòng chọn kích thước!');
                return false;
            }
        }
    });

</script>