@model DemoWeb.Models.Product
@{
    ViewBag.Title = "Thêm sản phẩm mới";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow-lg">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">
                        <i class="fas fa-plus-circle"></i> THÊM SẢN PHẨM MỚI
                    </h3>
                </div>
                <div class="card-body p-4">
                    @using (Html.BeginForm("Create", "Admin", FormMethod.Post, new { enctype = "multipart/form-data", @class = "needs-validation" }))
                    {
                        @Html.AntiForgeryToken()

                        if (!ViewData.ModelState.IsValid)
                        {
                            <div class="alert alert-danger">
                                @Html.ValidationSummary(true, "Vui lòng kiểm tra lại các trường bên dưới.")
                            </div>
                        }

                        <div class="row">
                            <!-- Cột trái - Thông tin sản phẩm -->
                            <div class="col-md-8">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-info-circle text-primary"></i> Thông tin cơ bản
                                </h5>

                                <div class="form-group">
                                    <label class="font-weight-bold">
                                        Tên sản phẩm <span class="text-danger">*</span>
                                    </label>
                                    @Html.TextBoxFor(m => m.Name, new
                                    {
                                        @class = "form-control form-control-lg",
                                        placeholder = "Nhập tên sản phẩm...",
                                        required = "required",
                                        autofocus = "autofocus"
                                    })
                                    @Html.ValidationMessageFor(m => m.Name, "", new { @class = "text-danger small" })
                                </div>

                                <div class="form-group">
                                    <label class="font-weight-bold">Mô tả chi tiết</label>
                                    @Html.TextAreaFor(m => m.Description, new
                                    {
                                        @class = "form-control",
                                        rows = "5",
                                        placeholder = "Nhập mô tả chi tiết về sản phẩm..."
                                    })
                                    <small class="form-text text-muted">
                                        <i class="fas fa-lightbulb"></i> Mô tả càng chi tiết càng tốt để khách hàng hiểu rõ về sản phẩm
                                    </small>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">
                                                Danh mục <span class="text-danger">*</span>
                                            </label>
                                            @if (ViewBag.Categories != null && ViewBag.Categories.Count > 0)
                                            {
                                                <select name="Category" class="form-control" required>
                                                    <option value="">-- Chọn danh mục --</option>
                                                    @foreach (var cat in ViewBag.Categories)
                                                    {
                                                        <option value="@cat">@cat</option>
                                                    }
                                                    <option value="_new">➕ Tạo danh mục mới</option>
                                                </select>
                                                @Html.TextBoxFor(m => m.Category, new
                                                {
                                                    @class = "form-control mt-2",
                                                    id = "newCategory",
                                                    placeholder = "Nhập tên danh mục mới...",
                                                    style = "display:none;"
                                                })
                                            }
                                            else
                                            {
                                                @Html.TextBoxFor(m => m.Category, new
                                                {
                                                    @class = "form-control",
                                                    placeholder = "Nhập danh mục...",
                                                    required = "required"
                                                })
                                            }
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">Loại sản phẩm</label>
                                            @Html.TextBoxFor(m => m.Type, new
                                            {
                                                @class = "form-control",
                                                placeholder = "VD: Nhẫn cưới, Dây chuyền..."
                                            })
                                            <small class="form-text text-muted">Loại cụ thể của sản phẩm</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">
                                                Giá bán (VNĐ) <span class="text-danger">*</span>
                                            </label>
                                            @Html.TextBoxFor(m => m.Price, new
                                            {
                                                @class = "form-control",
                                                type = "number",
                                                step = "1000",
                                                min = "0",
                                                placeholder = "0",
                                                required = "required"
                                            })
                                            <small class="form-text text-muted">
                                                <i class="fas fa-tag"></i> Giá sẽ hiển thị cho khách hàng
                                            </small>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">Giới tính</label>
                                            <select name="Gender" class="form-control">
                                                <option value="">-- Chọn giới tính --</option>
                                                <option value="Nam">👨 Nam</option>
                                                <option value="Nữ">👩 Nữ</option>
                                                <option value="Unisex">🧑 Unisex</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cột phải - Upload ảnh -->
                            <div class="col-md-4">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-image text-primary"></i> Hình ảnh
                                </h5>

                                <div class="form-group">
                                    <label class="font-weight-bold">Ảnh sản phẩm</label>

                                    <div class="custom-file mb-3">
                                        <input type="file" name="imageFile" class="custom-file-input" id="imageFile" accept="image/*" onchange="previewImage(this)">
                                        <label class="custom-file-label" for="imageFile">Chọn hình ảnh...</label>
                                    </div>

                                    <div class="text-center border rounded p-3 bg-light">
                                        <img id="imagePreview"
                                             src="~/Content/images/no-image.png"
                                             alt="Preview"
                                             class="img-fluid rounded shadow-sm"
                                             style="max-height: 300px; width: 100%; object-fit: contain;" />
                                    </div>

                                    <small class="form-text text-muted mt-2">
                                        <i class="fas fa-info-circle"></i> Định dạng: JPG, PNG, GIF (Max 5MB)
                                    </small>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" />

                        <div class="form-group mb-0">
                            <button type="submit" class="btn btn-success btn-lg px-5">
                                <i class="fas fa-save"></i> Lưu sản phẩm
                            </button>
                            <a href="@Url.Action("Products")" class="btn btn-secondary btn-lg px-4 ml-2">
                                <i class="fas fa-times"></i> Hủy bỏ
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                // Check file size (max 5MB)
                if (input.files[0].size > 5242880) {
                    alert('File quá lớn! Vui lòng chọn ảnh dưới 5MB.');
                    input.value = '';
                    return;
                }

                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#imagePreview').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);

                var fileName = input.files[0].name;
                $(input).next('.custom-file-label').html(fileName);
            }
        }

        // Handle category dropdown
        $(document).ready(function () {
            $('select[name="Category"]').change(function () {
                if ($(this).val() === '_new') {
                    $('#newCategory').show().attr('required', 'required');
                    $(this).removeAttr('required');
                } else {
                    $('#newCategory').hide().removeAttr('required');
                    $(this).attr('required', 'required');
                }
            });
        });
    </script>

    <style>
        .card {
            border: none;
        }

        .form-control:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        .custom-file-label::after {
            content: "Chọn file";
        }
    </style>
}