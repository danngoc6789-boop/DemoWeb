
@model IEnumerable<DemoWeb.Models.GoldPrice>
@{
    ViewBag.Title = "Bảng Giá Vàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Breadcrumb {
    <div class="breadcrumb-box">
        <a href="@Url.Action("Index","Trangchu")">Trang chủ</a>
        <span class="breadcrumb-sep">/</span>
        <span>Bảng Giá Vàng</span>
    </div>
}
<div class="container mt-5">
    <h2 class="text-center mb-4">BẢNG GIÁ VÀNG HÔM NAY</h2>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">
            <strong>Lỗi:</strong> @ViewBag.Error
        </div>
    }

    @if (Model != null && Model.Count() > 0)
    {
        <div class="alert alert-info">
            <strong>Cập nhật lúc:</strong> @Model.First().Timestamp.ToString("HH:mm dd/MM/yyyy")
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-warning">
                    <tr>
                        <th>Loại vàng</th>
                        <th>Tuổi vàng</th>
                        <th>Độ tinh khiết</th>
                        <th class="text-end">Mua vào</th>
                        <th class="text-end">Bán ra</th>
                        <th>Cập nhật</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var gold in Model)
                    {
                        <tr>
                            <td><strong>@gold.ProductName</strong></td>
                            <td>@gold.Karat</td>
                            <td>@(string.IsNullOrEmpty(gold.Purity) ? "-" : gold.Purity + "%")</td>
                            <td class="text-end">
                                @if (gold.BuyPrice > 0)
                                {
                                    <strong class="text-success">@gold.BuyPrice.ToString("N0")đ</strong>
                                }
                                else
                                {
                                    <span class="text-muted">Liên hệ</span>
                                }
                            </td>
                            <td class="text-end">
                                @if (gold.SellPrice > 0)
                                {
                                    <strong class="text-danger">@gold.SellPrice.ToString("N0")đ</strong>
                                }
                                else
                                {
                                    <span class="text-muted">Liên hệ</span>
                                }
                            </td>
                            <td>@gold.Timestamp.ToString("HH:mm dd/MM/yyyy")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="alert alert-warning mt-3">
            <strong>Lưu ý:</strong>
            <ul class="mb-0">
                <li>Giá có thể thay đổi theo từng giờ</li>
                <li>Giá thu mua lại trang sức đã qua sử dụng phụ thuộc tính trang sức, đá phụ tạp, trọng lượng thực tế</li>
                <li>Trang sức có đá, kim cương, charm đặc biệt sẽ được báo giá riêng</li>
            </ul>
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <strong>Thông báo:</strong> Không có dữ liệu giá vàng. Vui lòng thử lại sau.
        </div>
    }
</div>

<style>
    .table thead th {
        background-color: #ffc107;
        color: #000;
        font-weight: bold;
    }

    .table tbody tr:hover {
        background-color: #fff3cd;
    }

    .text-success {
        color: #28a745 !important;
    }

    .text-danger {
        color: #dc3545 !important;
    }
</style>
@* Thêm vào cuối file *@

<script>
    // Tự động refresh trang mỗi 5 phút
    setTimeout(function () {
        location.reload();
    }, 5 * 60 * 1000); // 5 phút = 5 * 60 * 1000 milliseconds
</script>

@* Hoặc nếu muốn hiển thị countdown: *@

<div id="countdown" class="text-center text-muted mt-3">
    Tự động cập nhật sau: <span id="timer">5:00</span>
</div>

<script>
    var timeLeft = 300; // 5 phút = 300 giây
    var timerElement = document.getElementById('timer');

    var countdown = setInterval(function () {
        timeLeft--;
        var minutes = Math.floor(timeLeft / 60);
        var seconds = timeLeft % 60;
        timerElement.textContent = minutes + ':' + (seconds < 10 ? '0' : '') + seconds;

        if (timeLeft <= 0) {
            clearInterval(countdown);
            location.reload();
        }
    }, 1000);
</script>